<div class="container mt-4">
  <h2 class="fw-semibold text-center mb-4">‚ûï Crear Nueva Cuenta</h2>

  <div class="card shadow-sm">
    <div class="card-body">
      <form [formGroup]="accountForm" (ngSubmit)="onSubmit()">
        <!-- C√≥digo -->
        <div class="mb-3">
          <label class="form-label fw-bold">C√≥digo *</label>
          <input
            type="text"
            class="form-control"
            formControlName="code"
            placeholder="Ej: 111, 1101, etc."
            [class.is-invalid]="codeControl?.invalid && codeControl?.touched"
          />
          <div class="invalid-feedback" *ngIf="codeControl?.invalid && codeControl?.touched">
            <div *ngIf="codeControl?.errors?.['required']">El c√≥digo es requerido</div>
            <div *ngIf="codeControl?.errors?.['pattern']">El c√≥digo debe contener solo n√∫meros</div>
          </div>
          <small class="text-muted">Solo n√∫meros. Ejemplo: 100, 110, 111</small>
        </div>

        <!-- Nombre -->
        <div class="mb-3">
          <label class="form-label fw-bold">Nombre *</label>
          <input
            type="text"
            class="form-control"
            formControlName="name"
            placeholder="Ej: Caja, Banco Naci√≥n, etc."
            [class.is-invalid]="nameControl?.invalid && nameControl?.touched"
          />
          <div class="invalid-feedback" *ngIf="nameControl?.invalid && nameControl?.touched">
            <div *ngIf="nameControl?.errors?.['required']">El nombre es requerido</div>
            <div *ngIf="nameControl?.errors?.['minlength']">El nombre debe tener al menos 3 caracteres</div>
          </div>
        </div>

        <!-- Tipo -->
        <div class="mb-3">
          <label class="form-label fw-bold">Tipo *</label>
          <select class="form-select" formControlName="type">
            <option *ngFor="let type of accountTypes" [value]="type.value">
              {{ type.label }}
            </option>
          </select>
          <small class="text-muted">Selecciona el tipo de cuenta contable</small>
        </div>

        <!-- Cuenta Padre -->
        <div class="mb-3">
          <label class="form-label fw-bold">Cuenta Padre (opcional)</label>
          <select class="form-select" formControlName="parentCode">
            <option [ngValue]="null">-- Sin cuenta padre (cuenta ra√≠z) --</option>
            <option *ngFor="let account of parentAccounts" [value]="account.code">
              {{ account.code }} - {{ account.name }}
            </option>
          </select>
          <small class="text-muted">
            Solo cuentas <strong>no imputables</strong> pueden ser padres. Deja vac√≠o para crear una cuenta ra√≠z.
          </small>
        </div>

        <!-- Imputable -->
        <div class="mb-3 form-check">
          <input
            type="checkbox"
            class="form-check-input"
            id="imputable"
            formControlName="imputable"
          />
          <label class="form-check-label" for="imputable">
            <strong>Cuenta Imputable</strong> (recibe movimientos contables)
          </label>
          <div>
            <small class="text-muted">
              ‚ö†Ô∏è Las cuentas imputables NO pueden tener subcuentas
            </small>
          </div>
        </div>

        <!-- Mensajes -->
        <div *ngIf="message" class="alert alert-success">{{ message }}</div>
        <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

        <!-- Botones -->
        <div class="text-center mt-4">
          <button
            type="submit"
            class="btn btn-success btn-lg px-5 me-3"
            [disabled]="loading || accountForm.invalid"
          >
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            üíæ Crear Cuenta
          </button>

          <button
            type="button"
            class="btn btn-outline-secondary btn-lg px-5"
            (click)="cancel()"
            [disabled]="loading"
          >
            ‚ùå Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Ayuda -->
  <div class="alert alert-info mt-4">
    <h6 class="fw-bold">üí° Reglas para crear cuentas:</h6>
    <ul class="mb-0">
      <li>El <strong>c√≥digo</strong> debe ser √∫nico y solo n√∫meros</li>
      <li>Las cuentas <strong>imputables</strong> reciben movimientos (asientos contables)</li>
      <li>Las cuentas <strong>no imputables</strong> son agrupadoras y pueden tener subcuentas</li>
      <li>Solo cuentas <strong>no imputables y activas</strong> pueden ser padres</li>
      <li>Si marcas una cuenta como <strong>imputable</strong>, NO podr√° tener hijos</li>
    </ul>
  </div>

  <!-- Loading state -->
  <div *ngIf="loadingAccounts" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando cuentas...</span>
    </div>
  </div>
</div>
