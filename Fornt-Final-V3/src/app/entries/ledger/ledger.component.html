<div class="container mt-4">
  <h2 class="fw-semibold text-center mb-4">ðŸ“˜ Libro Mayor</h2>

  <!-- ðŸ”¹ Filtros -->
  <form class="row g-3 mb-4 justify-content-center" (ngSubmit)="loadLedger()">
    <div class="col-md-4">
      <label class="form-label">Cuenta</label>
      <select
        class="form-select"
        [(ngModel)]="selectedAccountId"
        name="account"
        required
      >
        <option [ngValue]="null">Seleccione una cuenta</option>
        <option *ngFor="let a of accounts" [ngValue]="a.id">
          {{ a.code }} - {{ a.name }}
        </option>
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label">Desde</label>
      <input type="date" class="form-control" [(ngModel)]="from" name="from" />
    </div>

    <div class="col-md-3">
      <label class="form-label">Hasta</label>
      <input type="date" class="form-control" [(ngModel)]="to" name="to" />
    </div>

    <div class="col-md-2 d-flex align-items-end">
      <button class="btn btn-primary w-100" type="submit" [disabled]="loading">
        <i class="bi bi-search"></i> Buscar
      </button>
    </div>
  </form>

  <!-- ðŸ”¹ Spinner -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <!-- ðŸ”¹ Tabla -->
  <div *ngIf="!loading && ledger && ledger.length > 0" class="table-responsive">
    <table class="table table-striped align-middle shadow-sm">
      <thead class="table-dark">
      <tr>
        <th>Fecha</th>
        <th>Asiento</th>
        <th>DescripciÃ³n</th>
        <th class="text-end">DÃ©bito</th>
        <th class="text-end">CrÃ©dito</th>
        <th class="text-end">Saldo</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let d of ledger; let i = index">
        <td>{{ d.date | date: 'yyyy-MM-dd' }}</td>
        <td>#{{ d.entryId }}</td>
        <td>{{ d.description }}</td>
        <td class="text-end">{{ d.debit || 0 | number: '1.2-2' }}</td>
        <td class="text-end">{{ d.credit || 0 | number: '1.2-2' }}</td>
        <td
          class="text-end fw-semibold"
          [class.text-success]="balance >= 0"
          [class.text-danger]="balance < 0"
        >
          {{ getPartialBalance(i) | number: '1.2-2' }}
        </td>
      </tr>
      </tbody>

      <tfoot class="fw-bold table-light">
      <tr>
        <td colspan="3" class="text-end">Totales</td>
        <td class="text-end">{{ totalDebit | number: '1.2-2' }}</td>
        <td class="text-end">{{ totalCredit | number: '1.2-2' }}</td>
        <td
          class="text-end"
          [class.text-success]="balance >= 0"
          [class.text-danger]="balance < 0"
        >
          {{ balance | number: '1.2-2' }}
        </td>
      </tr>
      </tfoot>
    </table>
  </div>

  <!-- ðŸ”¹ Mensajes -->
  <p
    *ngIf="!loading && ledger?.length === 0 && !error"
    class="text-center text-muted mt-4"
  >
    No hay movimientos para los filtros seleccionados.
  </p>

  <p *ngIf="error" class="text-danger text-center mt-3">{{ error }}</p>
</div>
